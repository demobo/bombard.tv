<script type="text/javascript">
	DEMOBO_DEV=false;
</script>
<script src="../jquery.min.js"></script>
<script src="http://api.demobo.com/js_all_.js"></script>
<script src="backgroundMessaging.js"></script>
<script type="text/javascript">
if (DEMOBO) {
	DEMOBO.developer = 'developer@demobo.com';
	setController();
	DEMOBO.maxPlayers = 4;
	$.demobo.getDeviceInfo("","setDevice");
	$.demobo.addEventListener('textchange',sendEventToFrontground,false);
	$.demobo.addEventListener('textreturn',sendEventToFrontground,false);
	$.demobo.addEventListener('button',sendEventToFrontground,false);
}
function sendEventToFrontground(e) {
	var evt = JSON.stringify({deviceID:e.deviceID,timeStamp:e.timeStamp,value:e.value,type:e.type});
	console.log("handleBackgroundEvent("+evt+")");
	chrome.tabs.getSelected(null, function(tab) {
		if (tab.url.indexOf('youtube.com')==-1) return;
    	chrome.tabs.executeScript(tab.id, { code: "handleBackgroundEvent("+evt+")" });
	});
}
function setController() {
	chrome.tabs.getSelected(null, function(tab) {
		DEMOBO.controller = {"page": "remote"};
		$.demobo.setController(DEMOBO.controller);
	});
}
var device;
function setDevice(data) {
	device = data;
	console.log(device);
};
function sendToPhone(string) { //string is the text the user selected on the page
	return 'successful';
}
function onMenuClick(e) {
	return true;
}
chrome.contextMenus.create({
    "title": "Send to phone",
    "contexts": ["page", "selection", "image", "link"],
    "onclick" : onMenuClick
});
</script>